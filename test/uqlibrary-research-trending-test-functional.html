<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=no">
  <title>uqlibrary-timeline</title>

  <script src="../../webcomponentsjs/webcomponents.min.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <link rel="import" href="../uqlibrary-research-trending.html">
</head>
<body>
<uqlibrary-api-account id="account" autoload="true" ></uqlibrary-api-account>
<uqlibrary-research-trending></uqlibrary-research-trending>

<script>
  window.addEventListener('polymer-ready', function() {

    var trending = document.querySelector('uqlibrary-research-trending');
    var account = document.querySelector('uqlibrary-api-account');
    var user = null;

    trending.$.api.$.list.useMockData = true;
    account.$.account.useMockData = true;

    describe('uqlibrary-research application functional tests', function () {

      before(function () {
      });

      beforeEach(function () {
      });

      afterEach(function () {
      });

      it('should load and display data from api', function(done) {
        //TODO: write tests when api is ready
        done();
      });

      it('should display load user from api and them load publications', function(done) {
        expect(account).not.to.be.null;
        expect(trending).not.to.be.null;

        account.addEventListener('uqlibrary-api-account-loaded', function(e) {
          setTimeout(function() {
            trending.user = e.detail;
          }, 500);
        });

        trending.addEventListener('uqlibrary-research-trending-loaded', function(){
          setTimeout(function() {
            // Check number of cards
            var cards = trending.shadowRoot.querySelectorAll('paper-shadow.card');
            expect(cards.length).to.be.equal(Object.keys(trending.publications).length + 1); // Research guide card included (instead of author_details) + 1 for 'no publications' card

            //Check items for each card
            expect(trending.publications.altmetric).to.have.deep.property('[1].title', trending.publications.altmetric[1].title);
            expect(trending.publications.thomson).to.have.deep.property('[0].title', trending.publications.thomson[0].title);
            expect(trending.publications.scopus).to.have.deep.property('[0].title', trending.publications.scopus[0].title);

            done();

          }, 2000);

        });


        account.get();

      });



    });
  });
</script>

</body>
</html>
