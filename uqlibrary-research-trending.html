<link rel="import" href="../uqlibrary-elements/0.5.4/lib/vulcanized.html">

<polymer-element name="uqlibrary-research-trending" layout center attributes="user">
  <template>
    <uqlibrary-api-academic-trending-publications id="api"></uqlibrary-api-academic-trending-publications>
    <link rel="stylesheet" href="../uqlibrary-elements/resources/theme/element.css">

    <div id="cards" vertical center-justified layout>
      <template repeat="{{card in cards}}">
        <paper-shadow class="card" z="1" hidden?="{{ !publications[card['type']] || publications[card['type']].length == 0}}">
        <div class="subhead cardSection cardTitle">{{card.title}}</div>
          <template repeat="{{ pub, index in publications[card['type']] }}">
            <div vertical layout>

                <div horizontal layout center>
                    <div class="new-title" flex>{{pub.title}}</div>
                    <div class="num-cites border-left" self-stretch>{{pub.count}}</div>
                    <div class="num-cites border-left" self-stretch>{{pub.change}}</div>
                    </div>
                </div>
                <hr class="thin" hidden?="{{index == publications[card['type']].length -1}}">
          </template>
        </paper-shadow>

      </template>
      <paper-shadow class="card" z="1">
        <div class="subhead cardSection cardTitle">Research Guides</div>
        <p class="link"><core-icon icon="description"></core-icon>Guide to getting published</p>
        <p class="link"><core-icon icon="arrow-forward"></core-icon>See all research support</p>
      </paper-shadow>
    </div>

  </template>

  <script>

    Polymer('uqlibrary-research-trending', {
      publications: [],
      user: null,

      cards: [
        {
          'type' : 'altmetric',
          'title' : 'Altmetrics'
        },
        {
          'type' : 'thomson',
          'title' : 'Web of Science'
        },
        {
          'type' : 'scopus',
          'title' : 'Scopus'
        }
      ],

      created: function() {
      },

      ready: function() {
        var that = this;

        this.$.api.addEventListener('uqlibrary-api-academic-trending-publication', function(e) {
          that.publications = e.detail;
          console.log(that.publications);
        });
      },

      userChanged: function(newValue) {

        if(this.user.hasOwnProperty('id')) {
          this.$.api.get({'username' : this.user.id});
        }
      }


    });

  </script>

</polymer-element>